# 量子跃迁 AI 修图工作室 (QuantumLeap AI Studio) 产品需求文档 (PRD)

## 1. 产品概述 (Product Overview)

**产品名称**: 量子跃迁 AI 修图工作室 (QuantumLeap AI Studio)  
**产品定位**: 一款基于 Google Gemini 模型的全能型 AI 视觉创作工作站，专为设计师、摄影师和 AI 艺术创作者打造。它集成了从视觉分析、创意生成到后期精修的完整工作流，并独创了“灵感知识库”与“AI 记忆”机制，实现越用越懂用户的创作体验。

**核心价值**:
*   **深度解构**: 不仅仅是“看”图，而是从专业摄影视角“理解”图片（光影、构图、品牌、情感）。
*   **可控生成**: 通过“一致性”与“非一致性”提示词分离，以及“主图 (Master Image)”机制，解决了 AI 生成系列图风格不统一的痛点。
*   **智能进化**: 修图模块具备“记忆”功能，能从用户认可的修图操作中学习，不断优化建议质量。

## 2. 目标用户 (Target Audience)

*   **电商/商业摄影师**: 需要快速生成统一风格的产品图或模特图。
*   **视觉设计师**: 需要从现有素材中提取灵感，并进行二次创作。
*   **AI 绘画爱好者**: 希望对生成结果有更精细的控制，而非单纯依赖随机抽卡。

## 3. 技术架构 (Tech Stack)

*   **前端**: React 19, Vite, Tailwind CSS 4, Lucide React (图标)
*   **AI 模型**: Google Gemini 2.5 Flash (文本/分析), Gemini 2.5 Flash Image (图像生成)
*   **后端**: Node.js (Express) - 用于本地数据持久化 (JSON 存储) 和 代理请求。
*   **数据存储**: 本地文件系统 (`/data` 目录下的 JSON 文件)。

## 4. 功能模块详解 (Feature Specifications)

### 4.1. 模块一：智能解析 (Smart Analysis)
**目标**: 对一组图片进行深度视觉解构，提取共性与特性。

*   **输入**: 支持批量上传同一主题的多张图片。
*   **处理流程**:
    *   调用 Gemini Vision 模型分析图片。
    *   **一致性提取**: 识别所有图片共有的主体（物品、特征、材质、品牌、情感）、场景（地点、共享元素）、画质与构图（风格、光照、镜头）。
    *   **非一致性提取**: 识别每张图片的独特细节（景别、姿势、人物描述、宽高比、相机设置）。
*   **输出展示**: Markdown 格式的结构化报告。
*   **交互**:
    *   **一键拆解到知识库**: 将分析结果保存为可复用的 Prompt 片段。
    *   **去生成**: 将分析结果自动填充到“创意生成”模块，无缝衔接工作流。

### 4.2. 模块二：创意生成 (Creative Generation)
**目标**: 基于参考图和文本指令，生成高度可控、风格统一的系列图像。

*   **核心机制**: **Master Image (主图) 工作流**。
    1.  先生成一张完美确立风格的“主图”。
    2.  后续所有生成均以“主图”为视觉基准，确保系列图的一致性。
*   **输入**:
    *   **参考图**: 支持多张，上传时自动调用 AI **去除水印**。
    *   **一致性 Prompt**: 定义整个系列不变的元素（如“19岁亚洲女性，赛博朋克风格”）。支持从知识库导入。
    *   **非一致性 Prompt**: 定义单张图片的特定动作或特写。支持添加多条，支持从知识库导入。
*   **功能**:
    *   **生成主图**: 基于参考图 + 一致性 Prompt + 第一条非一致性 Prompt。
    *   **修改主图**: 对生成的主图进行微调（如“把背景换成红色”），保持人物/产品不变。
    *   **批量生成**: 锁定主图风格，批量执行所有非一致性 Prompt，生成系列套图。
    *   **单图重绘**: 对不满意的单张结果进行重新生成。
    *   **放大预览**: 查看大图细节。

### 4.3. 模块三：智能修图 (Smart Retouch)
**目标**: 对现有图片进行专业级的后期处理和重绘。

*   **UI 布局**: 3个独立的“创作单元” (Creative Units)，支持并行处理。
*   **流程**:
    1.  **上传**: 支持拖拽或点击上传。
    2.  **AI 诊断**: AI 扮演“创意总监”，从构图、光影、人物状态等方面提出修改建议（Directives）。
        *   *特性*: 会自动检索知识库中的“AI修图记忆”，应用过往成功的修图风格。
    3.  **用户干预**: 用户可以修改 AI 生成的建议文本。
    4.  **执行**: AI 基于原图 + 指令生成新图（支持结构性改变，如换姿势）。
    5.  **保存与学习**: 用户点击保存时，系统将当前的“修图指令”存入知识库，作为未来的学习样本。

### 4.4. 模块四：灵感知识库 (Inspiration Knowledge Base)
**目标**: 沉淀设计资产，实现 Prompt 的复用与管理。

*   **输入**: 上传任意图片。
*   **处理**: AI 生成一段极度详细的“母版描述” (Holistic Description)，并自动拆解为以下片段：
    *   Pose (姿势 & 动作)
    *   Scene (场景 & 环境)
    *   Composition (构图 & 镜头)
    *   Lighting (光照 & 氛围)
    *   Clothing (服装 & 造型)
    *   Style (风格 & 后期)
*   **功能**:
    *   **分类浏览**: 按上述类别查看 Prompt 片段。
    *   **搜索**: 关键词过滤。
    *   **AI 记忆**: 包含 `RETOUCH_LEARNING` 类别，存储智能修图的学习成果。
    *   **引用**: 在生成和修图模块中，可直接调用库中的片段。

## 5. 非功能性需求 (Non-Functional Requirements)

### 5.1. 用户体验 (UI/UX)
*   **风格**: 现代深色模式 (Dark Mode)，采用 Glassmorphism (毛玻璃) 效果，渐变色点缀（Fuchsia/Violet/Cyan）。
*   **交互**: 
    *   所有耗时操作需有明确的 Loading 状态（LoadingSpinner）。
    *   图片支持点击放大预览。
    *   关键操作（如删除）需有确认或防误触机制。
*   **响应式**: 适配桌面端和移动端布局。
*   **防干扰**: `index.html` 需配置 `translate="no"` 防止浏览器翻译插件破坏 React DOM。

### 5.2. 数据与安全
*   **API Key**: 用户需在前端输入 Google Gemini API Key，应用通过 Context 全局管理，不应硬编码在代码中。
*   **持久化**: 知识库数据通过后端 API 保存到本地 JSON 文件，确保重启后数据不丢失。

## 6. 接口定义 (API Endpoints - Local Server)

虽然是本地应用，但通过 Express Server 提供了类似 RESTful 的接口：

*   `GET /api/knowledge-base`: 获取所有知识库条目。
*   `POST /api/knowledge-base`: 新增条目。
*   `POST /api/knowledge-base/batch`: 批量新增。
*   `DELETE /api/knowledge-base/:id`: 删除条目。
*   `PUT /api/knowledge-base/:id/usage`: 增加条目使用计数。

## 7. 开发注意事项

1.  **Prompt Engineering**: 核心竞争力在于 `geminiService.ts` 中的 Prompt 模板。必须严格遵循“角色设定 + 任务描述 + 强制指令 + 输出格式”的结构。
2.  **异步处理**: 图像生成耗时较长，前端必须做好异步状态管理，避免界面卡死。
3.  **类型安全**: 严格遵守 `types.ts` 中的接口定义，特别是 AI 返回的 JSON 数据解析，需做错误处理。
